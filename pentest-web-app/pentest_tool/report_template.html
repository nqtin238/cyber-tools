<!DOCTYPE html>
<html>
<head>
    <title>Pentest Report</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .high { color: red; }
        .medium { color: orange; }
        .low { color: green; }
        .accordion { margin: 20px 0; }
        .accordion-item { border: 1px solid #ddd; margin-bottom: 5px; }
        .accordion-header { background-color: #f2f2f2; padding: 10px; cursor: pointer; }
        .accordion-content { padding: 10px; display: none; }
        .accordion-content.active { display: block; }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll(".accordion-header").forEach(header => {
                header.addEventListener("click", () => {
                    const content = header.nextElementSibling;
                    content.classList.toggle("active");
                });
            });
        });
    </script>
</head>
<body>
    <h1>Pentest Report - {{ timestamp }}</h1>
    <h2>Summary</h2>
    <p>High: {{ summary.high }}, Medium: {{ summary.medium }}, Low: {{ summary.low }}</p>
    <div class="accordion">
        <div class="accordion-item">
            <div class="accordion-header">CVEs Checked</div>
            <div class="accordion-content">
                <ul>
                {% for cve in cve_data %}
                    <li>{{ cve.id }} (CVSS: {{ cve.cvss_v3 }}, Affected: {{ cve.affected|join(', ') }})</li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <table>
        <tr>
            <th>Test</th>
            <th>Result</th>
            <th>Severity</th>
            <th>CVE Reference</th>
            <th>Suggestion</th>
        </tr>
        {% for test, result in results.items() %}
        <tr>
            <td>{{ test }}</td>
            <td>{{ result }}</td>
            <td class="{{ 'high' if 'Vulnerable' in result or 'WARNING' in result else 'medium' if 'No' in result else 'low' }}">{{ 'High' if 'Vulnerable' in result or 'WARNING' in result else 'Medium' if 'No' in result else 'Low' }}</td>
            <td>{{ results[test].split('(')[-1].rstrip(')') if '(' in results[test] else 'N/A' }}</td>
            <td>{{ 'Patch immediately' if 'Vulnerable' in result or 'WARNING' in result else 'Review configuration' if 'No' in result else 'No action needed' }}</td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>